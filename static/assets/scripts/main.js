/* Copyright (c) 2017 VisualSVN Software Ltd. All rights reserved. */
var PDFPageView=function(){function e(e,t,n,r,i){this.element=e;this.canvasWrapper=null;this.textLayer=null;this.container=t;this.pdfDoc=n;this.pageNumber=r;this.renderTask=null;this.renderTextTask=null;this.isVisible=false;e.className="pdf-page";e.style.width="100%";e.style.height=i+"px"}e.getPageHeight=function(t,n){var r=t.getViewport(1);var i=n.getBoundingClientRect();r=t.getViewport(i.width/r.width);return e.getCanvasDimensions(r).logicalHeight};e.prototype.show=function(){var e=this;if(this.isVisible)return;this.isVisible=true;if(!this.renderTask){this.pdfDoc.getPage(this.pageNumber).then(function(t){e.renderPage(t)})}};e.prototype.hide=function(){if(!this.isVisible)return;this.isVisible=false;this.setCanvasElement(null);this.setTextLayerElements(null);if(this.renderTask)this.renderTask.cancel();if(this.renderTextTask)this.renderTextTask.cancel()};e.getCanvasDimensions=function(e){var t=Math.floor(e.width*window.devicePixelRatio);var n=Math.floor(e.height*window.devicePixelRatio);var r=t/window.devicePixelRatio;var i=n/window.devicePixelRatio;return{physicalWidth:t,physicalHeight:n,logicalWidth:r,logicalHeight:i}};e.prototype.renderPage=function(t){var n=this;var r=this.element.getBoundingClientRect();var i=t.getViewport(1);i=t.getViewport(r.width/i.width);var o=e.getCanvasDimensions(i);var a=document.createElement("canvas");a.height=o.physicalHeight;a.width=o.physicalWidth;a.style.height=o.logicalHeight+"px";a.style.width=o.logicalWidth+"px";if(this.element.style.height!=a.style.height){this.element.style.height=a.style.height}var s=null;if(window.devicePixelRatio!==1){s=[window.devicePixelRatio,0,0,window.devicePixelRatio,0,0]}var l={canvasContext:a.getContext("2d"),transform:s,viewport:i};var c=t.render(l);this.renderTask=c;c.then(function(){if(c!==n.renderTask){return}if(n.isVisible){n.setCanvasElement(a);t.getTextContent({normalizeWhitespace:true}).then(function(e){if(!n.isVisible){return}var t=document.createDocumentFragment();var r={textContent:e,container:t,viewport:i,enhanceTextSelection:true};var o=PDFJS.renderTextLayer(r);n.renderTextTask=o;o.promise.then(function(){if(o!==n.renderTextTask){return}if(n.isVisible){n.renderTextTask.expandTextDivs(true);n.setTextLayerElements(t)}n.renderTextTask=null},function(e){if(o!==n.renderTextTask){return}n.renderTextTask=null})})}n.renderTask=null},function(e){if(c!==n.renderTask){return}n.renderTask=null})};e.prototype.setCanvasElement=function(e){if(e){if(this.canvasWrapper){this.canvasWrapper.innerHTML="";this.canvasWrapper.appendChild(e)}else{this.canvasWrapper=document.createElement("div");this.canvasWrapper.className="canvas-wrapper";this.canvasWrapper.appendChild(e);this.element.appendChild(this.canvasWrapper)}}else{if(this.canvasWrapper){this.canvasWrapper.innerHTML=""}}};e.prototype.setTextLayerElements=function(e){if(e){if(this.textLayer){this.textLayer.innerHTML="";this.textLayer.appendChild(e)}else{this.textLayer=document.createElement("div");this.textLayer.className="text-layer";this.textLayer.appendChild(e);this.element.appendChild(this.textLayer)}}else{if(this.textLayer){this.textLayer.innerHTML=""}}};return e}();var PDFViewer=function(){function e(e,t,n){this.lifetime=e;this.container=n;this.url=t}e.prototype.start=function(){var t=this;var n=new ElementCurtain(this.lifetime,this.container);n.showTemplate("<div class='progress-container'>"+"  <div class='progress-spinner'></div>"+"</div>");var r=PDFJS.getDocument(this.url);r.then(function(r){if(t.lifetime.isTerminated()){r.destroy();return}t.lifetime.addAction(function(){r.destroy()});var i=new Array;var o=function(e,t){e.forEach(function(e){var t=parseInt(e.target.dataset.pageNum,10);var n=i[t];if(e.isIntersecting){n.show()}else{n.hide()}})};var a=new IntersectionObserver(o,{});t.lifetime.addAction(function(){return a.disconnect()});var s=document.createElement("div");s.className="pdf-page-container";r.getPage(1).then(function(e){var o=PDFPageView.getPageHeight(e,t.container);for(var l=1;l<=r.numPages;l++){var c=document.createElement("div");var u=new PDFPageView(c,t.container,r,l,o);i[l]=u;c.dataset.pageNum=l;s.appendChild(c);a.observe(c)}n.showElement(s)},function(t){n.showTemplate("<h3 class='message'>Cannot display file content: {{message}}</h3>",{message:e.getErrorMessage(t)})})},function(t){n.showTemplate("<h3 class='message'>Cannot display file content: {{message}}</h3>",{message:e.getErrorMessage(t)})})};e.getErrorMessage=function(e){if(e instanceof Error){return e.message}else{return e}};return e}();$(function(){$(document).on("click",".popup-toggle",function(){var e=$(this);var t=$(e.data("toggle"));if(t.hasClass("popup-open")){t.removeClass("popup-open")}else{t.addClass("popup-open")}return false});$(document).on("click",function(e){if(e&&e.which===3)return;$(".popup-content.popup-open").each(function(){if(this!==e.target&&!$.contains(this,e.target)){$(this).removeClass("popup-open")}})});$(document).on("keydown",function(e){if(e.which==27){$(this).trigger("click")}})});var KeyboardManager=function(){function e(){Mousetrap.bind("]",function(e){var t=$("a[data-hotkey-prev]");if(t){var n=t.attr("href");if(n){window.location.hash=n}}});Mousetrap.bind("[",function(){var e=$("a[data-hotkey-next]");if(e){var t=e.attr("href");if(t){window.location.hash=t}}})}return e}();var MarkdownLinkResolver=function(){function e(e,t,n){this.base=e;this.router=t;this.svnClient=n}e.prototype.resolveLink=function(e){var t=Uri.getScheme(e);if(!t){var n=RepoPath.resolveRelativePath(this.base.path,e);if(n){return this.router.build(new RepoViewPlace(this.base.repo,this.base.rev,n))}}else if(t=="http"||t=="https"){return e}return""};e.prototype.resolveImage=function(e){var t=Uri.getScheme(e);if(!t){var n=RepoPath.resolveRelativePath(this.base.path,e);if(n){return this.svnClient.getFileContentURL(new SvnRepoPathRev(this.base.repo,n,this.base.rev))}}else if(t=="http"||t=="https"){return e}return""};return e}();var MarkedRenderImpl=function(){function e(e){this.resolver=e}e.prototype.code=function(e,t,n){if(!t){return"<pre><code>"+(n?e:this.escape(e,true))+"\n</code></pre>"}return'<pre><code class="'+this.escape(t,true)+'">'+(n?e:this.escape(e,true))+"\n</code></pre>\n"};e.prototype.blockquote=function(e){return"<blockquote>"+e+"</blockquote>"};e.prototype.html=function(e){return e};e.prototype.heading=function(e,t,n){return"<h"+t+">"+e+"</h"+t+">\n"};e.prototype.hr=function(){return"<hr>"};e.prototype.list=function(e,t){var n=t?"ol":"ul";return"<"+n+">\n"+e+"</"+n+">\n"};e.prototype.listitem=function(e){return"<li>"+e+"</li>\n"};e.prototype.paragraph=function(e){return"<p>"+e+"</p>\n"};e.prototype.table=function(e,t){return"<table><thead>"+e+"</thead><tbody>\n"+t+"</tbody></table>"};e.prototype.tablerow=function(e){return"<tr>\n"+e+"</tr>\n"};e.prototype.tablecell=function(e,t){var n=t.header?"th":"td";var r=t.align?"<"+n+' style="text-align:'+t.align+'">':"<"+n+">";return r+e+"</"+n+">\n"};e.prototype.strong=function(e){return"<strong>"+e+"</strong>"};e.prototype.em=function(e){return"<em>"+e+"</em>"};e.prototype.codespan=function(e){return'<span class="code-span">'+e+"</span>"};e.prototype.br=function(){return"<br>"};e.prototype.del=function(e){return"<del>"+e+"</del>"};e.prototype.link=function(e,t,n){e=this.resolver.resolveLink(e);var r='<a href="'+e+'"';if(t){r+=' title="'+t+'"'}r+=">"+n+"</a>";return r};e.prototype.image=function(e,t,n){e=this.resolver.resolveImage(e);var r='<img src="'+e+'" alt="'+n+'"';if(t){r+=' title="'+t+'"'}r+=">";return r};e.prototype.unescape=function(e){return e.replace(/&([#\w]+);/g,function(e,t){t=t.toLowerCase();if(t==="colon")return":";if(t.charAt(0)==="#"){return t.charAt(1)==="x"?String.fromCharCode(parseInt(t.substring(2),16)):String.fromCharCode(+t.substring(1))}return""})};e.prototype.escape=function(e,t){return e.replace(!t?/&(?!#?\w+;)/g:/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;")};return e}();var Markdown=function(){function e(){}e.prototype.render=function(e,t){return marked.parse(e,{renderer:new MarkedRenderImpl(t),sanitize:true})};return e}();var ReadmePresenter=function(){function e(e){this.curtain=e}e.prototype.setMarkdownReadme=function(e,t,n){var r=(new Markdown).render(t,n);var i="<div>"+"<div class='toolbar'>"+"  <div class='left'>"+"    <i class='fa fa-file-text-o'></i>&nbsp;{{title}}"+"  </div>"+"  <div class='center'></div>"+"  <div class='button-group right'></div>"+"</div>"+"<div id='file-content' class='markdown-body'>"+"  {{content}}"+"</div>"+"</div>";this.curtain.showTemplate(i,{title:e,content:new Handlebars.SafeString(r)})};e.prototype.setPlainReadme=function(e,t){var n="<div>"+"<div class='toolbar'>"+"  <div class='left'>"+"    <i class='fa fa-file-text-o'></i>&nbsp;{{title}}"+"  </div>"+"  <div class='center'></div>"+"  <div class='button-group right'></div>"+"</div>"+"<div id='file-content' class='readme-content'>"+"<pre>{{content}}</pre>"+"</div>"+"</div>";this.curtain.showTemplate(n,{title:e,content:t})};e.prototype.setLargeFileReadme=function(e){var t="<div>"+"<div class='toolbar'>"+"  <div class='left'>"+"    <i class='fa fa-file-text-o'></i>&nbsp;{{title}}"+"  </div>"+"  <div class='center'></div>"+"  <div class='button-group right'></div>"+"</div>"+"<div id='file-content' class='readme-notice'>"+"Text files larger than 1 MB cannot be displayed in browser."+"</div>"+"</div>";this.curtain.showTemplate(t,{title:e})};e.prototype.setError=function(e,t){var n="<div>"+"<div class='toolbar'>"+"  <div class='left'>"+"    <i class='fa fa-file-text-o'></i>&nbsp;{{title}}"+"  </div>"+"  <div class='center'></div>"+"  <div class='button-group right'></div>"+"</div>"+"<div id='file-content'>"+"  <h3 class='message'>{{error}}</h3>"+"</div>";this.curtain.showTemplate(n,{title:e,error:t})};return e}();var ReadmeController=function(){function e(e,t,n,r,i){this.lifetime=e;this.presenter=t;this.svnClient=n;this.model=r;this.router=i}e.prototype.start=function(e,t){var n=this;if(this.model.isLargeFile(t)){this.presenter.setLargeFileReadme(t.name)}else{this.svnClient.getFileContentByURL(this.lifetime,t.checkedInURL).done(function(r){if(n.isMarkdown(t)){var i=new MarkdownLinkResolver(e,n.router,n.svnClient);n.presenter.setMarkdownReadme(t.name,r,i)}else{n.presenter.setPlainReadme(t.name,r)}}).fail(function(e,r){n.presenter.setError(t.name,r)})}};e.prototype.isMarkdown=function(e){return e.name.toLowerCase().endsWith(".md")};return e}();Handlebars.registerHelper("add",function(e,t){return e+t});Handlebars.registerHelper("formatFileSize",formatFileSize);Handlebars.registerHelper("formatDate",formatDate);Handlebars.registerHelper("formatDateFromNow",formatDateFromNow);Handlebars.registerHelper("selfUrl",function(){return window.location.hash});var __extends=this.__extends||function(e,t){for(var n in t)if(t.hasOwnProperty(n))e[n]=t[n];function r(){this.constructor=e}r.prototype=t.prototype;e.prototype=new r};window.ErrorClass=Error;var UmbrellaError=function(e){__extends(t,e);function t(t,n){e.call(this,n+"\n"+t.join("\n"));this.name="UmbrellaError"}return t}(ErrorClass);String.prototype.endsWith=function(e){return this.indexOf(e,this.length-e.length)!==-1};String.prototype.startsWith=function(e){return this.indexOf(e)==0};if(!String.prototype.repeat){String.prototype.repeat=function(e){"use strict";if(this==null)throw new TypeError("can't convert "+this+" to object");var t=""+this;e=+e;if(e!=e)e=0;if(e<0)throw new RangeError("repeat count must be non-negative");if(e==Infinity)throw new RangeError("repeat count must be less than infinity");e=Math.floor(e);if(t.length==0||e==0)return"";if(t.length*e>=1<<28)throw new RangeError("repeat count must not overflow maximum string size");var n="";for(;;){if((e&1)==1)n+=t;e>>>=1;if(e==0)break;t+=t}return n}}var StringUtils=function(){function e(){}e.compare=function(e,t){if(e==t){return 0}else if(e>t){return 1}else{return-1}};e.compareLogical=function(t,n){var r=t.toLowerCase().match(/\d+|[^\d-]/g)||[];var i=n.toLowerCase().match(/\d+|[^\d-]/g)||[];function o(e,t){var n=/^(0*)(\d+)/.exec(e);var r=/^(0*)(\d+)/.exec(t);if(n[2].length!=r[2].length)return n[2].length-r[2].length;if(n[2]>r[2]){return 1}else if(n[2]<r[2]){return-1}else{return r[1].length-n[1].length}}for(var a=0;a<r.length&&a<i.length;a++){var s=r[a];var l=i[a];var c;if(/\d+/.test(s)&&/\d+/.test(l)){c=o(s,l)}else if(/\w/.test(s)&&/\w/.test(l)){c=s.localeCompare(l)}else{c=e.compare(s,l)}if(c!=0)return c}if(r.length==i.length){return e.compare(t,n)}else{return r.length-i.length}};return e}();var RepoPath=function(){function e(){}e.addComponent=function(e,t){if(e.lastIndexOf("/")==e.length-1)return e+t;else return e+"/"+t};e.removeLastComponent=function(e){var t=e.lastIndexOf("/");if(t==0){return"/"}else if(t>0){return e.substring(0,t)}else{return e}};e.split=function(e){if(e=="/")return Array();else return e.split("/").slice(1)};e.resolveRelativePath=function(t,n){if(!t.endsWith("/"))t=e.removeLastComponent(t);var r=n.split("/");if(!n.startsWith("/")){n=t}else{n="/"}for(var i=0;i<r.length;i++){var o=r[i];if(o==".."&&n!="/"){n=e.removeLastComponent(n)}else if(o==".."&&n=="/"){return null}else if(o!="."&&o!=""){n=e.addComponent(n,o)}}return n};return e}();var CanonicalUri=function(){function e(){}e.canonicalize=function(t){var n=new e;if(t.length==0)n.uri="/";else if(t.length!=1&&t[t.length-1]=="/")n.uri=t.substring(0,t.length-1);else n.uri=t;return n};e.prototype.toString=function(){return this.uri};e.skipCommonAncestor=function(e,t){if(t.uri.indexOf(e.uri)!=0)return null;if(t.uri.length==e.uri.length)return"";if(t.uri[e.uri.length]=="/")return t.uri.substring(e.uri.length+1);return null};return e}();var Uri=function(){function e(){}e.encodeComponents=function(e){return e.split("/").map(encodeURIComponent).join("/")};e.decodeComponents=function(e){return e.split("/").map(decodeURIComponent).join("/")};e.getScheme=function(e){var t=e.match(/^([^:/?#]+):/);if(t){return t[1].toLowerCase()}else{return null}};return e}();function formatFileSize(e){e=Math.ceil(e/1024);var t=e.toString();for(var n=t.length-3;n>0;n-=3){t=t.substr(0,n)+" "+t.substr(n)}return t+" KB"}function formatDate(e){return e.toLocaleString()}function formatDateFromNow(e){return moment(e).fromNow()}var HljsLanguages={js:"javascript",html:"xml",svg:"xml",xml:"xml",py:"python",c:"cpp",cpp:"cpp",h:"cpp",cs:"cs",java:"java",php:"php",go:"go",swift:"swift",cc:"objectivec",rb:"ruby",aspx:"xml",ascx:"xml",scss:"scss",css:"css",sh:"bash",groovy:"groovy",hs:"haskell",scala:"scala",ps1:"powershell",psd1:"powershell",psm1:"powershell",ts:"typescript",vcxproj:"xml",wxs:"xml",csproj:"xml",vbproj:"xml"};function getBaseUrl(e){return e.protocol+"//"+e.host}var ErrorsHandler=function(){function e(){var e=this;this.errorsWindow=new ErrorsWindow;window.addEventListener("error",function(t){var n="UNKNOWN";if(t.error!=undefined)n=t.error.message;else n=t.message;if(n==null)n="UNDEFINED";e.errorsWindow.append("Error: "+n)})}return e}();var ErrorsWindow=function(){function e(){var e=this;this.errorDiv=$("#errors-popup");this.errorDiv.click(function(){e.errorDiv.fadeOut(500);e.errorDiv.empty()})}e.prototype.append=function(e){this.errorDiv.append($("<p />",{text:e}));this.errorDiv.fadeIn(100)};return e}();PDFJS.disableRange=true;PDFJS.workerSrc="assets/scripts/pdf.worker.js?v=1";var HistoryEventsHandler=function(){function e(e){var t=this;this.lastUrl=null;this.navigator=e;var n=window.onpopstate;window.onpopstate=function(e){if(n)n(e);t.navigateTo(window.location.hash)};var r=window.onhashchange;window.onhashchange=function(e){if(r)r(e);t.navigateTo(window.location.hash)};this.navigateTo(window.location.hash)}e.prototype.navigateTo=function(e){if(e.indexOf("#")==-1)e="#"+e;if(this.lastUrl==e)return;this.lastUrl=e;this.navigator.navigateTo(e)};return e}();function startSvnWebClient(e){$(document).ready(function(){new ErrorsHandler;var t=new SvnClient(e);var n=new TopLevelView(document.getElementById("content"));var r=new TopLevelController(n,t);new HistoryEventsHandler(r)})}var Place=function(){function e(){}return e}();var DefaultPlace=function(){function e(){}return e}();var NotFoundPlace=function(){function e(e){this.error=e}return e}();var RepoViewPlace=function(){function e(e,t,n){if(typeof t==="undefined"){t=null}if(typeof n==="undefined"){n="/"}if(n.indexOf("/")!=0)throw Error("repository path should start with '/'");this.repoName=e;this.revision=t;this.repoPath=n}return e}();var HistoryPlace=function(){function e(t,n,r,i){if(typeof n==="undefined"){n=null}if(typeof r==="undefined"){r="/"}if(typeof i==="undefined"){i=e.DEFAULT_LIMIT}if(r.indexOf("/")!=0)throw Error("repository path should start with '/'");this.repoName=t;this.revision=n;this.repoPath=r;this.limit=i}e.DEFAULT_LIMIT=25;return e}();var CommitDetailsPlace=function(){function e(e,t,n,r){if(typeof n==="undefined"){n=null}if(typeof r==="undefined"){r="/"}if(r.indexOf("/")!=0)throw Error("repository path should start with '/'");this.repoName=e;this.revision=t;this.repoPath=r;this.pegRevision=n}return e}();var TopLevelCurtain=function(){function e(e,t){var n=this;this.isActive=true;this.view=t;var r=setTimeout(function(){if(n.isActive)n.view.setLoading()},200);this.closeTimer=function(){return clearTimeout(r)};e.addAction(this.closeTimer);e.addAction(function(){n.isActive=false})}e.prototype.showElement=function(e,t){if(this.isActive){this.closeTimer();this.view.show(e,t)}return t};e.prototype.showHtml=function(e,t){return this.showElement(e,$(t).get(0))};e.prototype.showTemplate=function(e,t,n){return this.showCompiledTemplate(e,Handlebars.compile(t),n)};e.prototype.showCompiledTemplate=function(e,t,n){return this.showHtml(e,t(n))};return e}();var ElementCurtain=function(){function e(e,t){var n=this;this.isActive=true;this.element=t;e.addAction(function(){n.isActive=false})}e.prototype.showElement=function(e){if(this.isActive){this.element.innerHTML="";this.element.appendChild(e)}return e};e.prototype.showHtml=function(e){return this.showElement($(e).get(0))};e.prototype.showTemplate=function(e,t){return this.showCompiledTemplate(Handlebars.compile(e),t)};e.prototype.showCompiledTemplate=function(e,t){return this.showHtml(e(t))};return e}();var TopLevelView=function(){function e(e){this.content=document.createElement("div");e.appendChild(this.content)}e.prototype.setLoading=function(){$("#loading").show()};e.prototype.setLoaded=function(){$("#loading").hide()};e.prototype.show=function(e,t){this.setLoaded();this.content.innerHTML="";this.content.appendChild(t);if(e){document.title=e+" — VisualSVN Server"}else{document.title="VisualSVN Server"}};return e}();var LifetimeImpl=function(){function e(e,t){this.disposables=[];this.id=e;this.isEternal=t}e.prototype.__close=function(){if(this.isEternal)throw Error("Cannot terminate Eternal lifetime");if(this.isTerminated())throw Error("Lifetime '"+this.id+"' was terminated twice");var e=this.disposables;this.disposables=null;e.forEach(function(e){return e.dispose()})};e.prototype.__removeNested=function(e){if(this.isEternal)return;if(this.isTerminated())return;var t;while((t=this.disposables.indexOf(e))!==-1){this.disposables.splice(t,1)}};e.prototype.isTerminated=function(){return!this.isEternal&&this.disposables==null};e.prototype.addAction=function(e){if(this.isEternal)return;if(this.isTerminated())throw Error("Lifetime '"+this.id+"' is terminated");this.disposables.push({dispose:function(){e()}})};e.prototype.addDispose=function(e){if(this.isEternal)return;if(this.isTerminated())throw Error("Lifetime '"+this.id+"' is terminated");this.disposables.push(e)};e.prototype.addDeffered=function(e){if(this.isEternal)return;if(this.isTerminated())throw Error("Lifetime '"+this.id+"' is terminated");this.disposables.push({dispose:function(){e.reject(null,"Interrupted")}})};e.prototype.addXhr=function(e){if(this.isEternal)return;if(this.isTerminated())throw Error("Lifetime '"+this.id+"' is terminated");this.disposables.push({dispose:function(){e.abort("Interrupted")}})};return e}();var LifetimeDefinition=function(){function e(e){this.lifetime=new LifetimeImpl(e,false)}e.prototype.terminate=function(){var e=this.lifetime;if(!e.isTerminated())e.__close()};return e}();var LifetimesImpl=function(){function e(){this.eternalLifetime=new LifetimeImpl("Eternal",true)}e.prototype.intersect=function(e,t,n){if(typeof n==="undefined"){n="unnamed"}var r=new LifetimeDefinition(n);var i={dispose:function(){r.terminate()}};e.addDispose(i);t.addDispose(i);r.lifetime.addAction(function(){e.__removeNested(i);t.__removeNested(i)});return r};e.prototype.define=function(e,t){if(typeof t==="undefined"){t="unnamed"}var n=new LifetimeDefinition(t);var r={dispose:function(){n.terminate()}};e.addDispose(r);n.lifetime.addAction(function(){e.__removeNested(r)});return n};return e}();var Lifetimes=new LifetimesImpl;var UrlBuilder=function(){function e(){this.url="#";this.implicit="";this.queryArgs={}}e.prototype.append=function(e,t){if(typeof t==="undefined"){t=null}var n=t!=null&&e==t;e=e.trim();if(e.lastIndexOf("/")==e.length-1)e=e.substring(0,e.length-1);if(e=="")e="/";if(e[0]!="/"&&this.url.length!=1)e="/"+e;e=encodeURI(e);if(n)this.implicit+=e;else{this.url+=this.implicit+e;this.implicit=""}return this};e.prototype.appendRev=function(e,t){if(typeof t==="undefined"){t=null}if(e==null&&t!=null){return this.append(t,t)}else{return this.append("r"+e.toString(10),t)}};e.prototype.setQueryArg=function(e,t,n){if(typeof n==="undefined"){n=null}if(n==null){this.queryArgs[e]=t}else if(t!=n){this.queryArgs[e]=t}return this};e.prototype.build=function(){var e="";for(var t in this.queryArgs){if(e.length>0)e+="&";e+=encodeURIComponent(t)+"="+encodeURIComponent(this.queryArgs[t])}if(e.length>0){return this.url+"?"+e}else{return this.url}};return e}();var UrlParser=function(){function e(e){var t=this;this.queryArgs={};this.isEnd=false;if(e[0]!="#"){this.isEnd=true;throw Error("Url should start with '#'")}e=e.substring(1);var n=e.indexOf("?");if(n>=0){var r=e.substring(n+1);r.split("&").forEach(function(e){var n=e.split("=");if(n.length==2){var r=decodeURIComponent(n[0]);var i=decodeURIComponent(n[1]);t.queryArgs[r]=i}});e=e.substring(0,n)}this.parts=e.split("/").map(function(e){return decodeURIComponent(e)});if(this.parts.lastIndexOf("")==this.parts.length-1)this.parts.pop();if(this.parts.length==0)this.isEnd=true}e.prototype.getNext=function(e){if(this.isEnd){return e}var t=this.parts.shift();if(this.parts.length==0)this.isEnd=true;return t};e.prototype.getRestAsUrl=function(e){if(this.isEnd){return e}else{return"/"+this.parts.join("/")}};e.prototype.getQueryArg=function(e,t){var n=this.queryArgs[e];if(n===undefined)return t;else return n};return e}();var RouteImpl=function(){function e(){}e.prototype.build=function(e){if(e==null){return null}var t=new UrlBuilder;if(e instanceof DefaultPlace){return t.build()}if(e instanceof RepoViewPlace){var n=e;t.append(n.repoName);t.append("view","view");t.appendRev(n.revision,"head");t.append(n.repoPath,"/");return t.build()}else if(e instanceof HistoryPlace){var r=e;t.append(r.repoName);t.append("history");t.appendRev(r.revision,"head");t.append(r.repoPath,"/");t.setQueryArg("limit",r.limit.toString(10),HistoryPlace.DEFAULT_LIMIT.toString(10));return t.build()}else if(e instanceof CommitDetailsPlace){var i=e;t.append(i.repoName);t.append("commit");t.appendRev(i.revision);t.appendRev(i.pegRevision,"head");t.append(i.repoPath,"/");return t.build()}throw Error("Unknown place:"+typeof e)};e.prototype.parse=function(e){try{var t=new UrlParser(e)}catch(n){return new NotFoundPlace(n)}var r=t.getNext(null);if(r==null){return new DefaultPlace}var i=t.getNext("view");if(i=="view"){var o=t.getNext("head");var a;if(o=="head"){a=null}else if(o.startsWith("r")){a=parseInt(o.substring(1),10)}else{return new NotFoundPlace("Invalid revision '"+o+"'")}var e=t.getRestAsUrl("/");return new RepoViewPlace(r,a,e)}else if(i=="history"){var o=t.getNext("head");var a;if(o=="head"){a=null}else if(o.startsWith("r")){a=parseInt(o.substring(1),10)}else{return new NotFoundPlace("Invalid revision '"+o+"'")}var e=t.getRestAsUrl("/");var s=parseInt(t.getQueryArg("limit",HistoryPlace.DEFAULT_LIMIT.toString(10)),10);return new HistoryPlace(r,a,e,s)}else if(i=="commit"){var o=t.getNext(null);if(o==null)new NotFoundPlace("Missing revision number");var a;if(o.startsWith("r")){a=parseInt(o.substring(1),10)}else{return new NotFoundPlace("Invalid revision '"+o+"'")}var o=t.getNext("head");var l;if(o=="head"){l=null}else if(o.startsWith("r")){l=parseInt(o.substring(1),10)}else{return new NotFoundPlace("Invalid revision '"+o+"'")}var e=t.getRestAsUrl("/");return new CommitDetailsPlace(r,a,l,e)}else{return new NotFoundPlace("Unknown verb '"+i+"'")}};return e}();var SvnClient=function(){function e(e){this.root=e}e.prototype.getRevisionRootUrl=function(e){var t=this.root+e.repo;if(e.rev!==null){t+="/!svn/rvr/"+e.rev.toString(10)}t+=e.path;t=Uri.encodeComponents(t);return t};e.fqdnName=function(e){return e.namespaceURI+e.localName};e.prototype.parsePropStatElement=function(t,n){$.each(t.childNodes,function(t,r){if(e.fqdnName(r)=="DAV:prop"){$.each(r.childNodes,function(t,r){var i=e.fqdnName(r);if(i=="DAV:resourcetype"){n[i]=false;$.each(r.childNodes,function(t,r){if(e.fqdnName(r)=="DAV:collection"){n[i]=true}})}else if(i=="DAV:checked-in"){$.each(r.childNodes,function(t,r){if(e.fqdnName(r)=="DAV:href"){n[i]=r.textContent}})}else{n[i]=r.textContent}})}});return n};e.prototype.getRepoList=function(e){var t=jQuery.Deferred();e.addDeffered(t);var n=jQuery.ajax(this.root);e.addXhr(n);n.done(function(e,n,r){var i=$(e).find("dir").map(function(){return{name:$(this).attr("name")}}).toArray();t.resolve(i)}).fail(function(e,n,r){t.reject(null,r)});return t.promise()};e.prototype.getDir=function(t,n,r,i){var o=this;if(typeof i==="undefined"){i=null}var a=this.root+n;if(i!==null){a+="/!svn/rvr/"+i.toString(10)}a+=r;var s=CanonicalUri.canonicalize(a);a=Uri.encodeComponents(a);var l="";l+='<?xml version="1.0" encoding="utf-8"?>';l+='<propfind xmlns="DAV:" xmlns:S="http://subversion.tigris.org/xmlns/svn/">';l+="<prop>";l+='<resourcetype xmlns="DAV:" />';l+='<getcontentlength xmlns="DAV:" />';l+='<version-name xmlns="DAV:" />';l+='<creator-displayname xmlns="DAV:" />';l+='<creationdate xmlns="DAV:" />';l+='<checked-in xmlns="DAV:" />';l+="<S:mime-type />";l+="</prop>";l+="</propfind>";var c=jQuery.Deferred();t.addDeffered(c);var u=jQuery.ajax(a,{type:"PROPFIND",dataType:"xml",data:l,headers:{Depth:1}});t.addXhr(u);u.done(function(t,n,r){var i=new SvnDirInfo;$.each(t.documentElement.childNodes,function(t,n){if(e.fqdnName(n)=="DAV:response"){var r="";var a={};$.each(n.childNodes,function(t,n){if(e.fqdnName(n)=="DAV:propstat"){o.parsePropStatElement(n,a)}else if(e.fqdnName(n)=="DAV:href"){var i=Uri.decodeComponents(n.textContent);var l=CanonicalUri.canonicalize(i);r=CanonicalUri.skipCommonAncestor(s,l).toString()}});var l=new SvnNode(r,a);if(r.length>0){i.children.push(l)}else{i.thisNode=l}}});c.resolve(i)}).fail(function(e,t,n){c.reject(null,n)});return c.promise()};e.prototype.getFileContentURL=function(e){return this.getRevisionRootUrl(e)};e.prototype.getFileContentByURL=function(e,t){var n=jQuery.Deferred();e.addDeffered(n);var r=jQuery.ajax(t,{type:"GET",dataType:"text",headers:{}});e.addXhr(r);r.done(function(e,t,r){n.resolve(r.responseText)}).fail(function(e,t,r){n.reject(r)});return n.promise()};e.prototype.getFileContent=function(e,t,n,r){if(typeof r==="undefined"){r=null}var i=this.getRevisionRootUrl(new SvnRepoPathRev(t,n,r));return this.getFileContentByURL(e,i)};e.parsePathChangeElement=function(e,t){var n=e.attributes.getNamedItem("copyfrom-path");var r=e.attributes.getNamedItem("copyfrom-rev");var i=e.attributes.getNamedItem("text-mods").value=="true";var o=e.attributes.getNamedItem("prop-mods").value=="true";if(n!==null&&r!==null){return{kind:t,path:e.textContent,copyfromPath:n.value,copyfromRev:parseInt(r.value,10),textMods:i,propMods:o}}else{return{kind:t,path:e.textContent,textMods:i,propMods:o}}};e.parseLogItemResponse=function(t){var n=this;var r=null;var i=null;var o=null;var a=null;var s=new Array;$.each(t.childNodes,function(t,l){switch(e.fqdnName(l)){case"DAV:version-name":r=parseInt(l.textContent);break;case"DAV:comment":i=l.textContent;break;case"DAV:creator-displayname":o=l.textContent;break;case"svn:date":a=new Date(l.textContent);break;case"svn:added-path":s.push(n.parsePathChangeElement(l,0));break;case"svn:replaced-path":s.push(n.parsePathChangeElement(l,2));break;case"svn:deleted-path":s.push(n.parsePathChangeElement(l,3));break;case"svn:modified-path":s.push(n.parsePathChangeElement(l,1));break}});s.sort(function(e,t){return StringUtils.compare(e.path,t.path)});return new SvnLogEntry(r,o,a,i,s)};e.prototype.getLog=function(t,n,r){var i=this.getRevisionRootUrl(n);var o=jQuery.Deferred();t.addDeffered(o);var a='<S:log-report xmlns:S="svn:">';if(r.startRevision!==null){a+="<S:start-revision>"+r.startRevision+"</S:start-revision>"}if(r.endRevision!==null){a+="<S:end-revision>"+r.endRevision+"</S:end-revision>"}if(r.limit){a+="<S:limit>"+r.limit+"</S:limit>"}if(r.discoverChangedPath!==false){a+="<S:discover-changed-paths/>"}a+="<S:encode-binary-props />";a+="<S:path></S:path>";a+="</S:log-report>";var s=jQuery.ajax(i,{type:"REPORT",dataType:"xml",data:a});t.addXhr(s);s.done(function(t,n,r){var i=new Array;var a=t.getElementsByTagNameNS("svn:","log-item");$.each(a,function(t,n){i.push(e.parseLogItemResponse(n))});o.resolve(i)});s.fail(function(e,t,n){o.reject(null,n)});return o.promise()};e.prototype.getCommitDetails=function(e,t,n){var r=jQuery.Deferred();e.addDeffered(r);this.getLog(e,t,{limit:null,startRevision:n,endRevision:n}).done(function(e){var t=new Array;$.each(e,function(e,t){r.resolve(t)});r.resolve(null)}).fail(function(e,t){r.reject(null,t)});return r.promise()};e.prototype.getLocationSegments=function(e,t,n,r,i,o){var a=this.getRevisionRootUrl(new SvnRepoPathRev(t,n,r));var s=jQuery.Deferred();e.addDeffered(s);var l='<S:get-location-segments xmlns:S="svn:">'+"<S:path></S:path>";if(r!==null)l+="<S:peg-revision>"+r.toString(10)+"</S:peg-revision >";if(i!==null){l+="<S:start-revision>"+i.toString(10)+"</S:start-revision>"}if(o!==null){l+="<S:end-revision>"+o.toString(10)+"</S:end-revision>"}l+="</S:get-location-segments>";var c=jQuery.ajax(a,{type:"REPORT",dataType:"xml",data:l});e.addXhr(c);c.done(function(e,t,n){var r=e.getElementsByTagNameNS("svn:","location-segment");s.resolve($.map(r,function(e){var t=e.attributes.getNamedItem("range-start").value;var n=e.attributes.getNamedItem("range-end").value;var r=e.attributes.getNamedItem("path").value;return{rangeStart:parseInt(t,10),rangeEnd:parseInt(n,10),path:"/"+r}}))});c.fail(function(e,t,n){s.reject(null,n)});return s.promise()};e.prototype.getPegLocation=function(e,t,n,r,i){var o=jQuery.Deferred();e.addDeffered(o);this.getLocationSegments(e,t,n,r,i,i).done(function(e){$.each(e,function(e,t){o.resolve(t.path)});o.reject(null,"Invalid response")}).fail(function(e,t,n){o.reject(null,n)});return o.promise()};e.prototype.getRelativeSvnRepoUrl=function(e,t,n){return this.root+e+t};return e}();var SvnNode=function(){function e(e,t){this.name=e;this.contentLength=parseInt(t["DAV:getcontentlength"],10);this.revision=parseInt(t["DAV:version-name"],10);this.collection=t["DAV:resourcetype"];this.author=t["DAV:creator-displayname"];this.date=new Date(t["DAV:creationdate"]);this.checkedInURL=t["DAV:checked-in"];this.mimeType=t["http://subversion.tigris.org/xmlns/svn/mime-type"]}return e}();var SvnChangeKind;(function(e){e[e["Added"]=0]="Added";e[e["Modified"]=1]="Modified";e[e["Replaced"]=2]="Replaced";e[e["Deleted"]=3]="Deleted"})(SvnChangeKind||(SvnChangeKind={}));var SvnLogEntry=function(){function e(e,t,n,r,i){this.revision=e;this.author=t;this.date=n;this.message=r;this.changes=i}return e}();var SvnDirInfo=function(){function e(){this.children=new Array}return e}();var ChangeType;(function(e){e[e["Added"]=1]="Added";e[e["Removed"]=2]="Removed";
e[e["Unchanged"]=3]="Unchanged"})(ChangeType||(ChangeType={}));var DiffPresenter=function(){function e(e){this.templates={};this.classes={};this.curtain=e;this.templates[3]=Handlebars.compile("{{#each lines}}"+" <tr class='udiff-line' >"+"   <td class='line-number' data-line-num='{{add ../oldLineNumber @index}}' />"+"   <td class='line-number' data-line-num='{{add ../newLineNumber @index}}' />"+"   <td class='line-code'> {{this}}</td>"+" </tr>"+"{{/each}}");this.templates[1]=Handlebars.compile("{{#each lines}}"+" <tr class='udiff-line added' >"+"   <td class='line-number' />"+"   <td class='line-number' data-line-num='{{add ../newLineNumber @index}}' />"+"   <td class='line-code'>+{{this}}</td>"+" </tr>"+"{{/each}}");this.templates[2]=Handlebars.compile("{{#each lines}}"+" <tr class='udiff-line removed' >"+"   <td class='line-number' data-line-num='{{add ../oldLineNumber @index}}' />"+"   <td class='line-number' />"+"   <td class='line-code'>-{{this}}</td>"+" </tr>"+"{{/each}}");this.moreUpTemplate=Handlebars.compile("<tr><td colspan='2'><input id='up' class='fa more-up' type='button' value='' /></td><td class='line-code'></tr>");this.moreDownTemplate=Handlebars.compile("<tr><td colspan='2'><input id='down' class='fa more-down' type='button' value='' /></td><td class='line-code'></tr>");this.moreUpDownTemplate=Handlebars.compile("<tr>"+"  <td colspan='2'>"+"    <input id='down' class='fa more-down' type='button' value='' />"+"    <input id='up' class='fa more-up' type='button' value='' />"+"  </td><td class='line-code'>"+"</tr>")}e.prototype.setLoading=function(){this.curtain.showHtml("<div>Loading...</div>")};e.prototype.setError=function(e){var t="<div>ERROR: {{error}}</div>";this.curtain.showTemplate(t,{error:e})};e.prototype.showDiff2=function(e){var t=document.createElement("table");t.className="diff-container";var n=1,r=1;var i=document.createDocumentFragment();var o=$(i);var a=Array();var s=null;var l=null;for(var c=0;c<e.length;c++){var u=e[c];if(u.added||u.removed){var p=null;var d=this.renderLines(u.value,n,r,this.getChangeType(u));var h=$(d);h.appendTo(o);p=h.get(0);if(u.added){r+=u.value.length}else{n+=u.value.length}var f=l;l={before:s,after:null,firstNode:p,lastNode:i.lastChild,prevFragment:f};if(f!=null)f.nextFragment=l;a.push(l);s=null}else{console.assert(s==null);s={lines:u.value,oldRangeStart:n,newRangeStart:r};if(l!=null)l.after=s;n+=u.value.length;r+=u.value.length}}for(var c=0;c<a.length;c++){var v=a[c];this.appendBefore(v,3);this.appendAfter(v,3)}if(a.length>0){var v=a[0];while(v!=null){this.renderButtons(v.prevFragment,v);v=v.nextFragment}this.renderButtons(a[a.length-1],null)}t.appendChild(i);this.curtain.showElement(t)};e.prototype.renderButtons=function(e,t){var n=this;var r=null;if(e==null){if(t.before!=null&&t.before.lines.length>0){r=$(this.moreUpTemplate({}));r.insertBefore($(t.firstNode));t.upButtonBlock=r.get(0)}}else if(t==null){if(e.after!=null&&e.after.lines.length>0){r=$(this.moreDownTemplate({}));r.insertAfter($(e.lastNode));e.downButtonBlock=r.get(0)}}else{if(t.before!=null&&t.before.lines.length>0){r=$(this.moreUpDownTemplate({}));r.insertAfter($(e.lastNode));e.downButtonBlock=r.get(0);t.upButtonBlock=r.get(0)}}if(r==null)return;var i=$(r).find("#down");if(i.length>0){i.click(function(){var t=r.position().top;n.appendAfter(e,10);var i=e.downButtonBlock;if(i!=null){var o=$(i).position().top-t;$(document).scrollTop($(document).scrollTop()+o)}})}var o=$(r).find("#up");if(o.length>0){o.click(function(){n.appendBefore(t,10)})}};e.prototype.renderLines=function(e,t,n,r){return this.templates[r]({lines:e,oldLineNumber:t,newLineNumber:n})};e.prototype.getChangeType=function(e){if(e.added)return 1;else if(e.removed)return 2;else return 3};e.prototype.appendBefore=function(e,t){var n=e.firstNode;var r=e.before;if(r==null)return;if(r.lines.length==0)return;var i=t;if(r.lines.length<t)i=r.lines.length;i=Math.min(i,r.lines.length);var o=r.lines.splice(r.lines.length-i,i);var a=r.newRangeStart+r.lines.length;var s=r.oldRangeStart+r.lines.length;var l=this.renderLines(o,s,a,3);var c=$(l);c.insertBefore($(n));e.firstNode=c.get(0);if(r.lines.length==0){$(e.upButtonBlock).detach();e.upButtonBlock=null;if(e.prevFragment!=null)e.prevFragment.downButtonBlock=null}};e.prototype.appendAfter=function(e,t){var n=e.lastNode;var r=e.after;if(r==null)return n;if(r.lines.length==0)return n;var i=t;if(r.lines.length<t)i=r.lines.length;i=Math.min(i,r.lines.length);var o=r.lines.splice(0,i);var a=r.newRangeStart;var s=r.oldRangeStart;r.newRangeStart+=i;r.oldRangeStart+=i;var l=this.renderLines(o,s,a,3);var c=$(l);c.insertAfter($(n));e.lastNode=c.get(c.length-1);if(r.lines.length==0){$(e.downButtonBlock).detach();e.downButtonBlock=null;if(e.nextFragment!=null)e.nextFragment.upButtonBlock=null}};return e}();var DiffController=function(){function e(e,t){this.presenter=t;this.lifetime=e}e.prototype.start=function(e){var t=this;var n=Diff.diffLinesAsync(e.left?e.left.textContent:"",e.right?e.right.textContent:"",function(e){if(e instanceof Error)t.presenter.setError(e.message);else{t.presenter.showDiff2(e)}});this.lifetime.addAction(function(){return n.terminate()})};return e}();var RepoListActivity=function(){function e(e,t,n,r){this.lifetime=e;this.router=n;this.svnClient=r;this.presenter=t}e.prototype.start=function(e){var t=this;this.svnClient.getRepoList(this.lifetime).done(function(e){var n=e.map(function(e){return{name:e.name,url:t.router.build(new RepoViewPlace(e.name))}});t.presenter.setRepoList(n)}).fail(function(e,n){t.presenter.setError(n)})};return e}();var RepoListPresenter=function(){function e(e){this.curtain=e}e.prototype.setRepoList=function(e){var t="<div id='repo-list' class='table'>"+"  <div class='thead'>"+"    <span class='table-cell'></span >"+"    <span class='table-cell'>Name</span >"+"  </div>"+"<div class='tbody' >"+"  {{#each repos}}"+"    <a class='table-row' href='{{url}}'>"+"      <span class='table-cell icon'><i class='fa fa-database'></i></span>"+"      <span class='table-cell name'>{{name}}</span>"+"    </a>"+"  {{/each}}"+"</div>";this.curtain.showTemplate(null,t,{repos:e})};e.prototype.setError=function(e){var t="<div id='repo-list-error'>"+"<h1>ERROR: {{message}}</h1>"+"</div>";this.curtain.showTemplate("Error",t,{message:e})};return e}();var RepoViewActivity=function(){function e(e,t,n,r){this.lifetime=e;this.router=n;this.svnClient=r;this.presenter=t;this.model=new Model(r)}e.prototype.prepareBreadCrumbItems=function(e){var t=this;var n=RepoPath.split(e.repoPath);var r="/";var i=n.map(function(n){r=RepoPath.addComponent(r,n);return{name:n,url:t.router.build(new RepoViewPlace(e.repoName,e.revision,r))}});return[{url:this.router.build(new RepoViewPlace(e.repoName,e.revision,"/")),name:e.repoName}].concat(i)};e.prototype.prepareNavbar=function(e){var t=getBaseUrl(window.location)+this.svnClient.getRelativeSvnRepoUrl(e.repoName,e.repoPath,e.revision);return{breadcrumbItems:this.prepareBreadCrumbItems(e),homeUrl:this.router.build(new DefaultPlace),viewSwitcherSourceUrl:this.router.build(e),viewSwitcherHistoryUrl:this.router.build(new HistoryPlace(e.repoName,e.revision,e.repoPath)),svnRepoUrl:t,gotoHeadUrl:this.router.build(new RepoViewPlace(e.repoName,null,e.repoPath)),revision:e.revision,sourceViewActive:true}};e.prototype.buildTitle=function(e){return e.repoName+e.repoPath};e.prototype.getUpLevelUrl=function(e){if(e.repoPath!="/"){return this.router.build(new RepoViewPlace(e.repoName,e.revision,RepoPath.removeLastComponent(e.repoPath)))}else{return null}};e.isImageFile=function(e){var t=e.nodeInfo.checkedInURL.toLocaleLowerCase();return t.endsWith(".png")||t.endsWith(".gif")||t.endsWith(".jpg")||t.endsWith(".bmp")||t.endsWith(".jpeg")};e.isMarkdownFile=function(e){var t=e.nodeInfo.checkedInURL.toLocaleLowerCase();return t.endsWith(".md")};e.isPdfFile=function(e){var t=e.nodeInfo.checkedInURL.toLocaleLowerCase();return t.endsWith(".pdf")};e.prototype.showFile=function(t,n,r){if(e.isImageFile(t)){this.presenter.setImageContent(this.buildTitle(r),n,t,this.getUpLevelUrl(r))}else if(e.isPdfFile(t)){this.presenter.setPdfContent(this.buildTitle(r),this.lifetime,n,t,this.getUpLevelUrl(r))}else if(t.isBinaryFile){this.presenter.setBinaryFileContent(this.buildTitle(r),n,t,this.getUpLevelUrl(r))}else if(t.isLargeFile){this.presenter.setLargeFileContent(this.buildTitle(r),n,t,this.getUpLevelUrl(r))}else if(e.isMarkdownFile(t)){var i;var o;i=new SvnRepoPathRev(r.repoName,r.repoPath,r.revision);o=new MarkdownLinkResolver(i,this.router,this.svnClient);this.presenter.setMarkdownContent(this.buildTitle(r),n,t,this.getUpLevelUrl(r),o)}else{this.presenter.setTextFileContent(this.buildTitle(r),n,t,this.getUpLevelUrl(r))}};e.findBestReadme=function(e){var t=["readme.md","readme.txt","readme"];for(var n=0;n<t.length;n++){for(var r=0;r<e.length;r++){var i=e[r];if(!i.collection&&!Model.isBinaryMimeType(i.mimeType)){var o=i.name.toLowerCase();if(o==t[n]){return i}}}}return null};e.prototype.showDir=function(t,n,r){var i=this;var o=t.map(function(e){return{node:e,url:i.router.build(new RepoViewPlace(r.repoName,r.revision,RepoPath.addComponent(r.repoPath,e.name)))}});o.sort(function(e,t){if(e.node.collection>t.node.collection)return-1;else if(e.node.collection<t.node.collection)return 1;return StringUtils.compareLogical(e.node.name,t.node.name)});var a=this.presenter.setRepoContent(this.buildTitle(r),this.lifetime,n,o,this.getUpLevelUrl(r));var s=e.findBestReadme(t);if(s!==null){var l=new SvnRepoPathRev(r.repoName,r.repoPath,r.revision).addComponent(s.name);var c=new ReadmeController(this.lifetime,a,this.svnClient,this.model,this.router);c.start(l,s)}};e.prototype.showError=function(e,t){this.presenter.setRepoContentWithError(e,t)};e.prototype.start=function(e){var t=this;var n=this.prepareNavbar(e);this.model.getRepoNodeContent(this.lifetime,e.repoName,e.repoPath,e.revision).done(function(r){if(r.isCollection){t.showDir(r.children,n,e)}else t.showFile(r,n,e)}).fail(function(e,r){t.showError(r,n)})};return e}();var RepoViewPresenter=function(){function e(e){this.curtain=e}e.prototype.setRepoContentWithError=function(e,t){var n="<div id='repo-content'>"+"{{navbar}}"+"<div id='repo-content-error'>"+"<h3 class='message'>{{error}}</h3>"+"</div>"+"</div>";this.curtain.showTemplate("Error",n,{navbar:UIElements.renderNavbar(t),error:e})};e.prototype.setBinaryFileContent=function(e,t,n,r){var i="<div id='repo-content'>"+"{{navbar}}"+"<div class='toolbar'>"+"<div class='left'>"+"  {{#if upLevelUrl }}"+"  <a href='{{upLevelUrl}}' class='button left'><i class='fa fa-level-up'></i></a>"+"  {{/if}}"+"</div>"+"  <div class='center'></div>"+"  <div class='button-group right' >"+"<a href='{{contentURL}}' class='button text-button' download>Download</a>"+"  </div>"+"</div>"+"<div id='file-content'>"+"<h3 class='message'><a href='{{contentURL}}'>View Binary Content</a></h3>"+"</div>"+"</div>";this.curtain.showTemplate(e,i,{navbar:UIElements.renderNavbar(t),contentURL:n.nodeInfo.checkedInURL,upLevelUrl:r})};e.prototype.setTextFileContent=function(e,t,n,r){var i="<div id='repo-content'>"+"{{navbar}}"+"<div class='toolbar'>"+"<div class='left'>"+"  {{#if upLevelUrl }}"+"  <a href='{{upLevelUrl}}' class='button left'><i class='fa fa-level-up'></i></a>"+"  {{/if}}"+"</div>"+"  <div class='center'></div>"+"  <div class='button-group right' >"+"<a href='{{contentURL}}' class='button text-button' download>Download</a>"+"  </div>"+"</div>"+"<div id='file-content' class='text-view'>"+"<table class='file-source'><tr>"+"<td class='line-numbers'><pre>{{lineNumberSpans}}</pre></td>"+"<td class='content'><pre><code>{{textContent}}</code></pre></td>"+"</tr></table>"+"</div>"+"</div>";var o="";for(var a=1;a<=n.lineCount;a++){o+="<i data-line-number='"+a+"' />"}var s=this.curtain.showTemplate(e,i,{navbar:UIElements.renderNavbar(t),lineNumberSpans:new Handlebars.SafeString(o),textContent:n.textContent,contentURL:n.nodeInfo.checkedInURL,upLevelUrl:r});var l=$(s).find("code");var c=(n.nodeInfo.checkedInURL.match(/\.(\w+)$/)||[,""])[1];var u=HljsLanguages[c]||c;l.addClass(u);hljs.configure({languages:[]});hljs.highlightBlock(l.get(0))};e.prototype.setMarkdownContent=function(e,t,n,r,i){var o="<div id='repo-content'>"+"{{navbar}}"+"<div class='toolbar'>"+"<div class='left'>"+"  {{#if upLevelUrl }}"+"  <a href='{{upLevelUrl}}' class='button left'><i class='fa fa-level-up'></i></a>"+"  {{/if}}"+"</div>"+"  <div class='center'></div>"+"  <div class='button-group right' >"+"<a href='{{contentURL}}' class='button text-button' download>Download</a>"+"  </div>"+"</div>"+"<div id='file-content' class='markdown-view markdown-body'>{{markdown}}</div>"+"</div>";var a=(new Markdown).render(n.textContent,i);this.curtain.showTemplate(e,o,{navbar:UIElements.renderNavbar(t),contentURL:n.nodeInfo.checkedInURL,upLevelUrl:r,markdown:new Handlebars.SafeString(a)})};e.prototype.setImageContent=function(e,t,n,r){var i="<div id='repo-content'>"+"{{navbar}}"+"<div class='toolbar'>"+"<div class='left'>"+"  {{#if upLevelUrl }}"+"  <a href='{{upLevelUrl}}' class='button left'><i class='fa fa-level-up'></i></a>"+"  {{/if}}"+"</div>"+"  <div class='center'></div>"+"  <div class='button-group right' >"+"<a href='{{contentURL}}' class='button text-button' download>Download</a>"+"  </div>"+"</div>"+"<div id='file-content' class='image-view'>"+"<img src='{{contentURL}}' />"+"</div>";this.curtain.showTemplate(e,i,{navbar:UIElements.renderNavbar(t),contentURL:n.nodeInfo.checkedInURL,upLevelUrl:r})};e.prototype.setPdfContent=function(e,t,n,r,i){var o="<div id='repo-content'>"+"{{navbar}}"+"<div class='toolbar'>"+"<div class='left'>"+"  {{#if upLevelUrl }}"+"  <a href='{{upLevelUrl}}' class='button left'><i class='fa fa-level-up'></i></a>"+"  {{/if}}"+"</div>"+"  <div class='center'></div>"+"  <div class='button-group right' >"+"<a href='{{contentURL}}' class='button text-button' download>Download</a>"+"  </div>"+"</div>"+"<div id='file-content' >"+"  <div class='pdf-view' />"+"</div>"+"</div>";var a=this.curtain.showTemplate(e,o,{navbar:UIElements.renderNavbar(n),contentURL:r.nodeInfo.checkedInURL,upLevelUrl:i});var s=a.querySelector(".pdf-view");var l=new PDFViewer(t,r.nodeInfo.checkedInURL,s);l.start()};e.prototype.setRepoContent=function(e,t,n,r,i){var o="<div id='repo-content'>"+"{{navbar}}"+"<div id='directory-list' class='table'>"+"  <div class='thead'>"+"    <span class='table-cell'></span >"+"    <span class='table-cell'>Name</span >"+"    <span class='table-cell'>Size</span >"+"    <span class='table-cell'>Rev</span >"+"    <span class='table-cell'>Author</span>"+"    <span class='table-cell'>Date</span>"+"  </div>"+"<div class='tbody' >"+"  {{#if upLevelUrl }}"+"    <a class='dir table-row' href='{{upLevelUrl}}'>"+"      <span class='table-cell icon'><i class='fa fa-level-up'></i></span>"+"      <span class='table-cell name'>..</span>"+"      <span class='table-cell size'></span>"+"      <span class='table-cell rev'></span>"+"      <span class='table-cell author'></span>"+"      <span class='table-cell date'></span>"+"    </a>"+"  {{/if}}"+"  {{#each items}}"+"  {{#if node.collection }}"+"    <a class='dir table-row' href='{{url}}'>"+"      <span class='table-cell icon'><i class='fa fa-folder'></i></span>"+"  {{else}}"+"    <a class='file table-row' href='{{url}}'>"+"      <span class='table-cell icon'><i class='fa fa-file-text-o'></i></span >"+"  {{/if}}"+"      <span class='table-cell name'>{{node.name}}</span>"+"  {{#if node.collection }}"+"      <span class='table-cell size'></span>"+"  {{else}}"+"      <span class='table-cell size'>{{formatFileSize node.contentLength}}</span>"+"  {{/if}}"+"      <span class='table-cell rev'>r{{node.revision}}</span>"+"      <span class='table-cell author'>{{node.author}}</span>"+"      <span class='table-cell date'>{{#if node.date}}<span title='{{formatDate node.date}}'>{{formatDateFromNow node.date}}</span>{{else}}(no date){{/if}}</span>"+"  </a>"+"  {{/each}}"+"</div>"+"</div>"+"<div id='directory-list-readme'></div>"+"</div>";var a=this.curtain.showTemplate(e,o,{navbar:UIElements.renderNavbar(n),items:r,upLevelUrl:i});var s=a.querySelector("#directory-list-readme");var l=new ElementCurtain(t,s);return new ReadmePresenter(l)};e.prototype.setLargeFileContent=function(e,t,n,r){var i="<div id='repo-content'>"+"{{navbar}}"+"<div class='toolbar'>"+"<div class='left'>"+"  {{#if upLevelUrl }}"+"  <a href='{{upLevelUrl}}' class='button left'><i class='fa fa-level-up'></i></a>"+"  {{/if}}"+"</div>"+"  <div class='center'></div>"+"  <div class='button-group right' >"+"<a href='{{contentURL}}' class='button text-button' download>Download</a>"+"  </div>"+"</div>"+"<div class='notice'>"+"Text files larger than 1 MB cannot be displayed in browser."+"</div>"+"<div id='file-content'>"+"<h3 class='message'><a href='{{contentURL}}'>View Raw File Content</a></h3>"+"</div>"+"</div>";this.curtain.showTemplate(e,i,{navbar:UIElements.renderNavbar(t),contentURL:n.nodeInfo.checkedInURL,upLevelUrl:r})};return e}();var HistoryActivity=function(){function e(e,t,n,r){this.lifetime=e;this.router=n;this.svnClient=r;this.presenter=t}e.prototype.prepareBreadCrumbItems=function(e){var t=this;var n=RepoPath.split(e.repoPath);var r="/";var i=n.map(function(n){r=RepoPath.addComponent(r,n);return{name:n,url:t.router.build(new RepoViewPlace(e.repoName,e.revision,r))}});return[{url:this.router.build(new RepoViewPlace(e.repoName,e.revision,"/")),name:e.repoName}].concat(i)};e.prototype.prepareNavbar=function(e){var t=getBaseUrl(window.location)+this.svnClient.getRelativeSvnRepoUrl(e.repoName,e.repoPath,e.revision);return{breadcrumbItems:this.prepareBreadCrumbItems(e),homeUrl:this.router.build(new DefaultPlace),viewSwitcherSourceUrl:this.router.build(new RepoViewPlace(e.repoName,e.revision,e.repoPath)),viewSwitcherHistoryUrl:this.router.build(e),svnRepoUrl:t,gotoHeadUrl:this.router.build(new RepoViewPlace(e.repoName,null,e.repoPath)),revision:e.revision,historyViewActive:true}};e.prototype.buildTitle=function(e){return e.repoName+e.repoPath};e.prototype.showLog=function(e,t,n,r){var i=this;var o=e.map(function(e){return{node:e,url:i.router.build(new CommitDetailsPlace(n.repoName,e.revision,n.revision,n.repoPath))}});this.presenter.setRepoContent(this.buildTitle(n),o,t,this.router.build(r))};e.prototype.start=function(e){var t=this;var n=this.prepareNavbar(e);this.svnClient.getLog(this.lifetime,new SvnRepoPathRev(e.repoName,e.repoPath,e.revision),{limit:e.limit+1,startRevision:e.revision,endRevision:0,discoverChangedPath:false}).done(function(r){var i=null;if(r.length>e.limit){r.pop();i=new HistoryPlace(e.repoName,e.revision,e.repoPath,e.limit+HistoryPlace.DEFAULT_LIMIT)}t.showLog(r,n,e,i)}).fail(function(e,r){t.presenter.setRepoContentWithError(r,n)})};return e}();var HistoryPresenter=function(){function e(e){this.curtain=e}e.prototype.setRepoContentWithError=function(e,t){var n="<div id='repo-content'>"+"{{navbar}}"+"<div id='repo-content-error'>"+"<h3 class='message'>{{error}}</h3>"+"</div>"+"</div>";this.curtain.showTemplate("Error",n,{navbar:UIElements.renderNavbar(t),error:e})};e.prototype.setRepoContent=function(e,t,n,r){var i="<div id='repo-content'>"+"{{navbar}}"+"<div id='history-list' class='table'>"+"  <div class='thead'>"+"    <span class='table-row'>"+"      <span class='table-cell'>Rev</span >"+"      <span class='table-cell'>Author</span >"+"      <span class='table-cell'>Date</span >"+"      <span class='table-cell'>Message</span>"+"    </span>"+"  </div>"+"<div class='tbody' >"+"  {{#each items}}"+"  <a href='{{url}}' class='table-row'>"+"      <span class='table-cell rev'>r{{node.revision}}</span>"+"      <span class='table-cell author'>{{node.author}}</span>"+"      <span class='table-cell date'>{{#if node.date}}{{formatDate node.date}}{{else}}(no date){{/if}}</span>"+"      <span class='table-cell msg'><div title='{{node.message}}'>{{node.message}}</div></span>"+"  </a>"+"  {{/each}}"+"</div>"+"{{#if showMoreLink}}"+"  <a href='{{showMoreLink}}' class='show-more'>"+"  Show more"+"  </a>"+"{{/if}}"+"</div>"+"</div>";this.curtain.showTemplate(e,i,{navbar:UIElements.renderNavbar(n),items:t,showMoreLink:r})};return e}();var CommitDetailsActivity=function(){function e(e,t,n,r){var i=this;this.lifetime=e;this.router=n;this.svnClient=r;this.presenter=t;this.model=new Model(r);this.presenter.onShowDiff=function(e,t){return i.showDiff(e,t)}}e.prototype.prepareBreadCrumbItems=function(e){var t=this;var n=RepoPath.split(e.repoPath);var r="/";var i=n.map(function(n){r=RepoPath.addComponent(r,n);return{name:n,url:t.router.build(new RepoViewPlace(e.repoName,e.pegRevision,r))}});return[{url:this.router.build(new RepoViewPlace(e.repoName,e.pegRevision,"/")),name:e.repoName}].concat(i)};e.prototype.prepareNavbar=function(e){var t=getBaseUrl(window.location)+this.svnClient.getRelativeSvnRepoUrl(e.repoName,e.repoPath,e.revision);return{breadcrumbItems:this.prepareBreadCrumbItems(e),homeUrl:this.router.build(new DefaultPlace),viewSwitcherSourceUrl:this.router.build(new RepoViewPlace(e.repoName,e.pegRevision,e.repoPath)),viewSwitcherHistoryUrl:this.router.build(new HistoryPlace(e.repoName,e.pegRevision,e.repoPath)),svnRepoUrl:t,gotoHeadUrl:this.router.build(new RepoViewPlace(e.repoName,null,e.repoPath)),revision:e.pegRevision,historyViewActive:true}};e.prototype.buildTitle=function(e){return"r"+e.revision+" - "+e.repoName};e.prototype.getRevUrl=function(e,t){if(t==null){return null}else{return this.router.build(new CommitDetailsPlace(e.repoName,t,e.pegRevision,e.repoPath))}};e.prototype.showLogEntry=function(e,t,n,r,i){this.presenter.setContent(this.buildTitle(n),this.lifetime,e,t,this.getRevUrl(n,r),this.getRevUrl(n,i))};e.prototype.start=function(e){var t=this;var n=this.prepareNavbar(e);this.currentPlace=e;this.model.getCommitDetails(this.lifetime,e.revision,new SvnRepoPathRev(e.repoName,e.repoPath,e.pegRevision)).done(function(r){t.showLogEntry(r.logEntry,n,e,r.nextRev,r.prevRev)}).fail(function(e,r){t.presenter.setRepoContentWithError(r,n)})};e.prototype.showDiff=function(e,t){var n=this;var r;if(t.copyfromPath){r=this.router.build(new RepoViewPlace(this.currentPlace.repoName,t.copyfromRev,t.copyfromPath))}var i=e.showTemplate("<div>"+"{{#if copyfromUrl}}"+"<div class='details'>Copied from <a href='{{copyfromUrl}}'>{{copyfromPath}}@{{copyfromRev}}</div>"+"{{/if}}"+"<div class='diff'></div>"+"</div>",{copyfromUrl:r,copyfromPath:t.copyfromPath,copyfromRev:t.copyfromRev});if(t.textMods){var o=i.querySelector(".diff");var a=new ElementCurtain(this.lifetime,o);var s=new DiffPresenter(a);s.setLoading();this.model.getDataForCompare(this.lifetime,this.currentPlace.repoName,t.path,this.currentPlace.revision,t.kind).done(function(e){if(e.left&&e.left.isBinaryFile||e.right&&e.right.isBinaryFile){a.showTemplate("<div><h3 class='message'>File has binary content and cannot be displayed in a web browser.</h3></div>")}else{var t=new DiffController(n.lifetime,s);t.start(e)}}).fail(function(e,t){s.setError(t)})}};return e}();var CommitDetailsPresenter=function(){function e(e){this.curtain=e}e.prototype.setRepoContentWithError=function(e,t){var n="<div id='repo-content'>"+"{{navbar}}"+"<div id='repo-content-error'>"+"<h3 class='message'>{{error}}</h3>"+"</div>"+"</div>";this.curtain.showTemplate("Error",n,{navbar:UIElements.renderNavbar(t),error:e})};e.prototype.setContent=function(e,t,n,r,i,o){var a=this;var s="<div id='repo-content'>"+"{{navbar}}"+"<div id='commit-view' >"+"  <div class='toolbar'>"+"    <a href='{{viewSwitcherHistoryLink}}' class='button left text-button'>Back</a>"+"    <div class='center' >"+"      <span style='font-weight: normal;'>Revision</span> r{{logEntry.revision}} "+"      <span style='font-weight: normal;'>authored by</span> {{logEntry.author}} "+"      {{#if logEntry.date}}<span title='{{formatDate logEntry.date}}' style='font-weight: normal;'>{{formatDateFromNow logEntry.date}}</span>{{/if}}"+"    </div>"+"    <div class='right'>"+"      <a href='{{selfUrl}}' id='expand-all-btn' class='button text-button'>Expand all</a>"+"      <div class='button-group'>"+"      {{#if nextRevUrl}}"+"      <a href='{{nextRevUrl}}' class='button' title='Newer revision ( Type &#39;[&#39; )' data-hotkey-next><i class='fa fa-chevron-left'></i></a>"+"      {{else}}"+"      <button class='button' aria-pressed='disabled' title='Newer revision ( Type &#39;[&#39; )' disabled><i class='fa fa-chevron-left'></i></button>"+"      {{/if}}"+"      {{#if prevRevUrl}}"+"      <a href='{{prevRevUrl}}' class='button' title='Older revision ( Type &#39;]&#39; )' data-hotkey-prev><i class='fa fa-chevron-right'></i></a>"+"      {{else}}"+"      <button class='button' aria-pressed='disabled' title='Older revision ( Type &#39;]&#39; )' disabled><i class='fa fa-chevron-right'></i></button>"+"      {{/if}}"+"      </div>"+"    </div>"+"  </div>"+"  <div id='commit-details'>"+"  <pre id='commit-log-message'>{{logEntry.message}}</pre>"+"  </div>"+"  <div id='commit-changed-files'>"+"  {{#each changes}}"+"<div class='item' id='diff_{{@index}}'>"+"<div class='header'>"+"    <span class='{{cssClass}}'> {{path}}</span>"+"</div>"+"<div class='content'></div>"+"</div>"+"  {{/each}}"+"  </div>"+"</div>"+"</div>";var l=this.curtain.showTemplate(e,s,{navbar:UIElements.renderNavbar(r),logEntry:n,changes:n.changes.map(function(e){switch(e.kind){case 0:return{path:e.path,cssClass:"added-file"};case 3:return{path:e.path,cssClass:"deleted-file"};default:return{path:e.path,cssClass:"modified-file"}}}),nextRevUrl:i,prevRevUrl:o,viewSwitcherHistoryLink:r.viewSwitcherHistoryUrl});var c=Array();var u=$(l).find("#commit-changed-files");u.children().each(function(e,r){console.assert(r.attributes.getNamedItem("id").value=="diff_"+e);c.push(new FileItem(r,function(r){var i=new ElementCurtain(t,r);a.onShowDiff(i,n.changes[e])}))});$("#expand-all-btn").click(function(e){$.each(c,function(e,t){t.expand()})})};return e}();var FileItem=function(){function e(e,t){var n=this;this.isExpandedOnce=false;this.element=e;this.showDiff=t;var r=$(e).find(".header");this.anchorElement=e.querySelector(".content");console.assert(r.length==1);$(r).click(function(){return n.toggle()})}e.prototype.isExpanded=function(){return $(this.element).hasClass("expanded")};e.prototype.toggle=function(){if(this.isExpanded()){this.collapse()}else{this.expand()}};e.prototype.expand=function(){$(this.element).addClass("expanded");if(!this.isExpandedOnce){this.isExpandedOnce=true;this.showDiff(this.anchorElement)}};e.prototype.collapse=function(){$(this.element).removeClass("expanded")};return e}();var NotFoundActivity=function(){function e(e,t,n,r){this.lifetime=e;this.router=n;this.svnClient=r;this.presenter=t}e.prototype.start=function(e){this.presenter.setNotFound(e.error)};return e}();var NotFoundPresenter=function(){function e(e){this.curtain=e}e.prototype.setNotFound=function(e){var t="<header>"+"  <h1>"+"    Page not found"+"  </h1>"+"</header>"+"<div>"+"{{message}}"+"</div>";this.curtain.showTemplate("Not found",t,{message:e})};return e}();var SvnRepoPathRev=function(){function e(e,t,n){this.repo=e;this.path=t;this.rev=n}e.prototype.addComponent=function(t){return new e(this.repo,RepoPath.addComponent(this.path,t),this.rev)};return e}();var Model=function(){function e(e){this.svnClient=e;this.autoDownloadFileLimit=1*1024*1024}e.isBinaryMimeType=function(e){if(e){return!e.startsWith("text/")}else{return false}};e.isBinaryFile=function(t){if(t.mimeType)return e.isBinaryMimeType(t.mimeType);if(t.checkedInURL.toLocaleLowerCase().endsWith(".pdf"))return true;return false};e.prototype.isLargeFile=function(e){return e.contentLength>this.autoDownloadFileLimit};e.getTextLineCount=function(e){"use strict";var t=0;var n=0;while(true){var r=e.indexOf("\n",n);if(r<0){if(n<e.length){t++}break}else{t++;n=r+1}}return t};e.prototype.getCompareSide=function(t,n,r,i){var o=this;var a=jQuery.Deferred();t.addDeffered(a);this.svnClient.getDir(t,n,r,i).done(function(n){if(n.thisNode.collection){a.resolve({createdRev:n.thisNode.revision,isFile:false,mimeType:n.thisNode.mimeType,contentLength:n.thisNode.contentLength,textContent:null})}else if(e.isBinaryFile(n.thisNode)){a.resolve({createdRev:n.thisNode.revision,isFile:true,isBinaryFile:true,mimeType:n.thisNode.mimeType,contentLength:n.thisNode.contentLength,textContent:null})}else{o.svnClient.getFileContentByURL(t,n.thisNode.checkedInURL).done(function(e){a.resolve({createdRev:n.thisNode.revision,isFile:true,isBinaryFile:false,mimeType:n.thisNode.mimeType,contentLength:n.thisNode.contentLength,textContent:e})}).fail(function(e,t){a.reject(null,t)})}}).fail(function(e,t){a.reject(null,t)});return a.promise()};e.prototype.getDataForCompare=function(e,t,n,r,i){var o=jQuery.Deferred();e.addDeffered(o);var a;if(i!=0)a=this.getCompareSide(e,t,n,r-1);else a=null;var s;if(i!=3)s=this.getCompareSide(e,t,n,r);else s=null;jQuery.when(a,s).done(function(e,t){o.resolve(new CompareInfo(e,t))}).fail(function(e,t){o.reject(null,t)});return o.promise()};e.prototype.getRepoNodeContent=function(t,n,r,i){var o=this;var a=jQuery.Deferred();t.addDeffered(a);this.svnClient.getDir(t,n,r,i).done(function(n){if(n.thisNode.collection){a.resolve({nodeInfo:n.thisNode,isCollection:true,children:n.children})}else if(e.isBinaryFile(n.thisNode)){a.resolve({nodeInfo:n.thisNode,isCollection:false,isBinaryFile:true,isLargeFile:o.isLargeFile(n.thisNode)})}else if(o.isLargeFile(n.thisNode)){a.resolve({nodeInfo:n.thisNode,isCollection:false,isBinaryFile:false,isLargeFile:true})}else{o.svnClient.getFileContentByURL(t,n.thisNode.checkedInURL).done(function(t){a.resolve({nodeInfo:n.thisNode,isCollection:false,isBinaryFile:false,isLargeFile:false,textContent:t,lineCount:e.getTextLineCount(t)})}).fail(function(e,t){a.reject(null,t)})}}).fail(function(e,t){a.reject(null,t)});return a.promise()};e.prototype.getCommitDetails=function(e,t,n){var r=this;var i=jQuery.Deferred();e.addDeffered(i);this.svnClient.getLocationSegments(e,n.repo,n.path,n.rev,t,t).done(function(o){var a=o[0].path;var s=r.svnClient.getLog(e,n,{startRevision:t,endRevision:n.rev,limit:2});var l=r.svnClient.getLog(e,new SvnRepoPathRev(n.repo,a,t),{startRevision:t,endRevision:0,limit:2});$.when(s,l).done(function(e,t){var n=null;if(e.length>1)n=e[1].revision;var r=null;if(t.length>1)r=t[1].revision;i.resolve({nextRev:n,prevRev:r,logEntry:e[0]})}).fail(function(e,t){i.reject(null,t)})}).fail(function(e,t){i.reject(null,t)});return i.promise()};return e}();var CompareInfo=function(){function e(e,t){this.left=e;this.right=t}return e}();var PlaceToFactoryMap=function(){function e(e,t){this.check=e;this.factory=t}return e}();var TopLevelController=function(){function e(e,t){var n=this;this.placeToActivityMap=[];this.view=e;this.svnClient=t;this.router=new RouteImpl;this.keyboardManager=new KeyboardManager;this.placeToActivityMap.push(new PlaceToFactoryMap(function(e){return e instanceof DefaultPlace},function(e,t){return new RepoListActivity(e,new RepoListPresenter(t),n.router,n.svnClient)}));this.placeToActivityMap.push(new PlaceToFactoryMap(function(e){return e instanceof RepoViewPlace},function(e,t){return new RepoViewActivity(e,new RepoViewPresenter(t),n.router,n.svnClient)}));this.placeToActivityMap.push(new PlaceToFactoryMap(function(e){return e instanceof HistoryPlace},function(e,t){return new HistoryActivity(e,new HistoryPresenter(t),n.router,n.svnClient)}));this.placeToActivityMap.push(new PlaceToFactoryMap(function(e){return e instanceof CommitDetailsPlace},function(e,t){return new CommitDetailsActivity(e,new CommitDetailsPresenter(t),n.router,n.svnClient)}));this.placeToActivityMap.push(new PlaceToFactoryMap(function(e){return e instanceof NotFoundPlace},function(e,t){return new NotFoundActivity(e,new NotFoundPresenter(t),n.router,n.svnClient)}))}e.prototype.navigateTo=function(e){if(this.currentActivity!=null){var t=this.currentActivity;this.currentActivity=null;t.terminate()}this.currentActivity=Lifetimes.define(Lifetimes.eternalLifetime,e);var n=this.currentActivity.lifetime;
var r=new TopLevelCurtain(n,this.view);var i=this.router.parse(e);var o=null;for(var a in this.placeToActivityMap){var s=this.placeToActivityMap[a];if(s.check(i)){o=s.factory(n,r);break}}o.start(i)};return e}();var UIElements=function(){function e(){}e.renderNavbar=function(e){var t=Handlebars.compile("<header>"+"  <a href='{{repoListUrl}}' class='home navbar-item'><span class='fa fa-home'></span></a>"+"  <h1 class='navbar-item'>"+"    {{#each bcitems}}"+"      {{#if @first}}"+"      <a href='{{url}}'>{{name}}</a> /"+"      {{else}}"+"      <a href='{{url}}'>{{name}}</a>"+"      {{#unless @last}} / {{/unless}}"+"      {{/if}}"+"    {{/each}}"+"  </h1>"+"  <div class='view-switcher'>"+"    <div class='navbar-item popup-container'>"+"    {{#if revision}}"+"      <button href='{{gotoRevLink}}' class='popup-toggle button' data-toggle='#selectRevisionPopup'>"+"        <label>Revision:</label> <b>{{revision}}</b> <i class='fa fa-caret-down'/>"+"      </button>"+"      <div class='popup-content popup-right' id='selectRevisionPopup'>"+"       <a href='{{gotoHeadLink}}'>Go&nbsp;to&nbsp;the&nbsp;HEAD</a>"+"    </div>"+"    {{else}}"+"      <span class='button-box'>"+"        <label>Revision:</label> HEAD"+"      </span>"+"    {{/if}}"+"    </div>"+"    <div class='navbar-item popup-container'>"+"      <button class='popup-toggle button' data-toggle='#svnRepoUrl' title='Checkout'>"+"        <i class='fa fa-external-link'></i>"+"      </button>"+"      <div class='popup-content popup-right' id='svnRepoUrl'>"+"        <label>Repository URL:</label>"+"        <input type='text'"+"               value='{{svnRepoUrl}}'"+"               readonly='readonly'"+"               onfocus='this.select()' />"+"      </div>"+"    </div>"+"    <div class='button-group navbar-item'>"+"      <a href='{{viewSwitcherSourceLink}}' class='button' {{#if sourceViewActive}}aria-pressed='true'{{/if}} title='Source'><i class='fa fa-list' /></a>"+"      <a href='{{viewSwitcherHistoryLink}}' class='button' {{#if historyViewActive}}aria-pressed='true'{{/if}} title='History'><i class='fa fa-history' /></a>"+"    </div>"+"  </div>"+"</header>");return new Handlebars.SafeString(t({bcitems:e.breadcrumbItems,repoListUrl:e.homeUrl,viewSwitcherSourceLink:e.viewSwitcherSourceUrl,sourceViewActive:e.sourceViewActive,viewSwitcherHistoryLink:e.viewSwitcherHistoryUrl,historyViewActive:e.historyViewActive,svnRepoUrl:e.svnRepoUrl,gotoHeadLink:e.gotoHeadUrl,revision:e.revision}))};return e}();